---
title: "Regression Project – Group 3 (Intermediate Report)"
author: "Reema abolahum and Muzammil Mohammed"
date: 10.12.2025
embed-resources: true
toc: true
format: 
  html: 
    code-link: true
    code-tools: true
    toc-location: right
    df-print: paged
  pdf: 
    number-sections: true
  revealjs:
    output-ext: "revealjs-PRESENTATION.html"
    toc: false
    code-line-numbers: false
    echo: true
    scrollable: true
    code-link: true
    code-tools: true
    df-print: paged
    slide-number: true
---


```{r}
suppressPackageStartupMessages({
  library(tidyverse)
  library(readxl)
  library(simFrame)
  library(dplyr)        # data manipulation
  library(ggplot2)      # visualization
  library(tidyr)        # data tidying
  library(forcats)      # factor management
  library(effects)      # effect plots
  library(gt)
  library(corrplot)
  library(forcats)
  library(splines)
  library(car)
})

# Define color palette
main_color <- "#2C3E50"
accent_color <- "#E74C3C"
secondary_color <- "#3498DB"
tertiary_color <- "#F39C12"
quaternary_color <- "#9B59B6"
```

# 1. Introduction
This report analyzes determinants of employment income (`py010n`) in South Austria. We focus on data preparation, descriptive statistics, and regression modeling using polynomial and spline methods. Interactions between predictors are explored, and diagnostic checks are performed to validate model assumptions.

# 2. Data Collection and Preparation
```{r}
data("eusilcP")

dat <- eusilcP %>%
  select(py010n, gender, citizenship, hsize, age, region) %>%
  filter(region %in% c("Carinthia", "Styria")) %>%
  filter(py010n > 0)

dat$hsize <- as.numeric(as.character(dat$hsize))
dat <- na.omit(dat)
```

# 3. Descriptive Analysis
## 3.1 Numeric Summaries
```{r}
num_vars <- dat %>% select(py010n, age, hsize)
summary(num_vars)
```

## 3.2 Frequency Tables
```{r}
table(dat$gender)
table(dat$citizenship)
table(dat$gender, dat$citizenship)
```

## 3.3 Univariate Plots
```{r}
# Income
ggplot(dat, aes(y=py010n)) + 
  geom_boxplot(fill=secondary_color, alpha=0.7, color=main_color) + 
  labs(title="Income Boxplot") +
  theme_minimal()

ggplot(dat, aes(x=py010n)) + 
  geom_histogram(bins=50, fill=secondary_color, color=main_color, alpha=0.7) + 
  labs(title="Income Histogram") +
  theme_minimal()

# Age
ggplot(dat, aes(y=age)) + 
  geom_boxplot(fill=tertiary_color, alpha=0.7, color=main_color) + 
  labs(title="Age Boxplot") +
  theme_minimal()

ggplot(dat, aes(x=age)) + 
  geom_histogram(bins=30, fill=tertiary_color, color=main_color, alpha=0.7) + 
  labs(title="Age Histogram") +
  theme_minimal()

# Household Size
ggplot(dat, aes(y=hsize)) + 
  geom_boxplot(fill=accent_color, alpha=0.7, color=main_color) + 
  labs(title="Household Size Boxplot") +
  theme_minimal()

ggplot(dat, aes(x=hsize)) + 
  geom_histogram(binwidth=1, fill=accent_color, color=main_color, alpha=0.7) + 
  labs(title="Household Size Histogram") +
  theme_minimal()

# Gender
ggplot(dat, aes(x=gender, fill=gender)) + 
  geom_bar(alpha=0.8) + 
  scale_fill_manual(values=c("female"="#E74C3C", "male"="#3498DB")) +
  labs(title="Gender Frequency") +
  theme_minimal() +
  theme(legend.position="none")

# Citizenship
ggplot(dat, aes(x=citizenship, fill=citizenship)) + 
  geom_bar(alpha=0.8) +
  scale_fill_brewer(palette="Set2") +
  theme_minimal() +
  theme(axis.text.x=element_text(angle=45, hjust=1)) + 
  labs(title="Citizenship Frequency")
```

## 3.4 Bivariate Plots
```{r}
# Gender vs Income
ggplot(dat, aes(x=gender, y=py010n, fill=gender)) + 
  geom_boxplot(alpha=0.7) + 
  scale_fill_manual(values=c("female"="#E74C3C", "male"="#3498DB")) +
  labs(title="Income vs Gender") +
  theme_minimal() +
  theme(legend.position="none")

# Citizenship vs Income
ggplot(dat, aes(x=citizenship, y=py010n, fill=citizenship)) +
  geom_boxplot(alpha=0.7) + 
  scale_fill_brewer(palette="Set2") +
  theme_minimal() +
  theme(axis.text.x=element_text(angle=45, hjust=1)) + 
  labs(title="Income vs Citizenship")

# Age vs Income (Polynomial)
ggplot(dat, aes(x=age, y=py010n)) +
  geom_point(alpha=0.3, color=main_color, size=1.5) + 
  geom_smooth(method="lm", formula=y~poly(x,2), color=tertiary_color, fill=tertiary_color, alpha=0.2, linewidth=1.2) +
  labs(title="Income vs Age (2nd-degree polynomial)") +
  theme_minimal()

# Household size vs Income (Polynomial)
ggplot(dat, aes(x=hsize, y=py010n)) +
  geom_point(alpha=0.3, color=main_color, size=1.5) + 
  geom_smooth(method="lm", formula=y~poly(x,2), color=accent_color, fill=accent_color, alpha=0.2, linewidth=1.2) +
  labs(title="Income vs Household Size (2nd-degree polynomial)") +
  theme_minimal()
```

## 3.5 Interaction Plots
```{r}
# Gender × Citizenship
ggplot(dat, aes(x=gender, y=py010n, fill=citizenship)) +
  geom_boxplot(position="dodge", alpha=0.7) + 
  scale_fill_brewer(palette="Set2") +
  labs(title="Income Interaction: Gender × Citizenship") +
  theme_minimal()

# Age × Gender
ggplot(dat, aes(x=age, y=py010n, color=gender)) + 
  geom_point(alpha=0.3, size=1.5) + 
  geom_smooth(method="lm", se=TRUE, alpha=0.2, linewidth=1.2) +
  scale_color_manual(values=c("female"="#E74C3C", "male"="#3498DB")) +
  labs(title="Income Interaction: Age × Gender") +
  theme_minimal()

# Age × Citizenship
ggplot(dat, aes(x=age, y=py010n, color=citizenship)) + 
  geom_point(alpha=0.3, size=1.5) + 
  geom_smooth(method="lm", se=TRUE, alpha=0.2, linewidth=1.2) +
  scale_color_brewer(palette="Set2") +
  labs(title="Income Interaction: Age × Citizenship") +
  theme_minimal()

# Household Size × Gender
ggplot(dat, aes(x=hsize, y=py010n, color=gender)) + 
  geom_point(alpha=0.3, size=1.5) + 
  geom_smooth(method="lm", se=TRUE, alpha=0.2, linewidth=1.2) +
  scale_color_manual(values=c("female"="#E74C3C", "male"="#3498DB")) +
  labs(title="Income Interaction: Household Size × Gender") +
  theme_minimal()

# Household Size × Citizenship
ggplot(dat, aes(x=hsize, y=py010n, color=citizenship)) + 
  geom_point(alpha=0.3, size=1.5) + 
  geom_smooth(method="lm", se=TRUE, alpha=0.2, linewidth=1.2) +
  scale_color_brewer(palette="Set2") +
  labs(title="Income Interaction: Household Size × Citizenship") +
  theme_minimal()
```

## 3.6 Correlation / Scatterplot Matrix
```{r}
cor_mat <- cor(num_vars)
corrplot(cor_mat, method="ellipse", 
         col=colorRampPalette(c("#E74C3C", "white", "#3498DB"))(200),
         tl.col="black", tl.srt=45)

pairs(num_vars, 
      main="Scatterplot Matrix",
      col=alpha(main_color, 0.4),
      pch=19,
      cex=0.8)
```

# 4. Regression Modeling
## 4.1 Linear Model
```{r}
lm_model <- lm(py010n ~ gender + citizenship + hsize + age, data=dat)
summary(lm_model)
Anova(lm_model)
plot(allEffects(lm_model))
```

## 4.2 Polynomial Model
```{r}
poly_model <- lm(py010n ~ gender + citizenship + poly(age,2) + poly(hsize,2), data=dat)
summary(poly_model)
Anova(poly_model)
plot(allEffects(poly_model))
```

## 4.3 Spline Model
```{r}
spline_model <- lm(py010n ~ gender + citizenship + ns(age, df=3) + ns(hsize, df=3), data=dat)
summary(spline_model)
Anova(spline_model)
plot(allEffects(spline_model, xlevels=50))
```

## 4.4 Interaction Model
```{r}
int_model <- lm(py010n ~ (gender + citizenship + ns(age,3) + ns(hsize,3))^2, data=dat)
summary(int_model)
Anova(int_model)

# Plot main effects separately for clarity
plot(Effect("age", int_model, xlevels=50), 
     main="Effect of Age on Income",
     lines=list(col=tertiary_color, lwd=2))

plot(Effect("hsize", int_model, xlevels=50), 
     main="Effect of Household Size on Income",
     lines=list(col=accent_color, lwd=2))

plot(Effect("gender", int_model), 
     main="Effect of Gender on Income")

plot(Effect("citizenship", int_model), 
     main="Effect of Citizenship on Income")

# Plot key interactions
plot(Effect(c("age", "gender"), int_model, xlevels=50), 
     main="Age × Gender Interaction",
     lines=list(multiline=TRUE))

plot(Effect(c("hsize", "gender"), int_model, xlevels=50), 
     main="Household Size × Gender Interaction",
     lines=list(multiline=TRUE))
```

# 5. Summary
This analysis shows skewed income with outliers, gender and citizenship differences, nonlinear relationships with age and household size, and relevant interactions. Polynomial and spline regressions provide flexible modeling of numeric predictors, and residual diagnostics suggest the models are adequate.